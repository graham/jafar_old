<html>
    <head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8">
        <title>testing</title>
        
        <script type="text/javascript" charset="utf-8" src='/a/js/jquery.js'> </script>
        <script type="text/javascript" charset="utf-8" src='/genie/genie.js'> </script>
        <script type="text/javascript" charset="utf-8" src='/genie/kapture.js'> </script>
        <script type="text/javascript" charset="utf-8" src='/genie/ut.js'> </script>
        <script type="text/javascript" charset="utf-8" src='/clients/jafar.js'> </script>
        
        <link href="/css/bootstrap.css" rel="stylesheet">

        <style type='text/css'>
          #left_nav {
            font-size: 14px;
            float: left;
            width: 140px;
          }

          #target {
            margin-left: 140px;
            padding-top: 4px;
            padding-left: 4px;
          }
        </style>

        <script type="text/javascript" charset="utf-8">        
          var env = null;
	  var api = [];
          var kap = new Kapture();

          $(document).ready(function() {
            env = new genie.Environment();
	    env.load_template_dir('/templates/', get_data);

            $(window).keydown( function(e) {kap.key_down(e);} );
            $(window).keyup( function(e) {kap.key_up(e);} );
	  
            kap.add_passive_command('alt-1', function(term) {
              load_page('home');
            });
            kap.add_passive_command('alt-2', function(term) {
              load_page('blocking');
            });
            kap.add_passive_command('alt-3', function(term) {
              load_page('contexts');
            });
            kap.add_passive_command('alt-4', function(term) {
              load_page('projects');
            });
            kap.add_passive_command('alt-5', function(term) {
              load_page('people');
            });

          });

	  function get_data() {
	    $.get('/_api_list/', function(data) {
	      api = JSON.parse(data);
	      start_render();
	    });
	  }

	  function start_render() {
	    console.log('start render');
            $('#target').html( env.render('index', {api:api}) );
            $('#left_nav').html( env.render('left_nav'));
	  }

          function load_page(name) {
            $('#target').html( env.render(name) );
            $('#left_nav > .well > .nav').children().removeClass('active');
            $('#' + name + '_li').addClass('active');
          }

        </script>

    </head>
    <body>
      <div id='container'>
      <div id='left_nav'>loading...</div>
      <div id='target'>loading...</div>
      </div>
    </body>
</html>
